From c1a329d4034f9524b832c892c7325fe631e1d27b Mon Sep 17 00:00:00 2001
From: X512 <danger_mail@list.ru>
Date: Thu, 18 Jun 2020 14:34:05 +0900
Subject: Haiku: build fixes

---
 configure.ac                 | 1 +
 ext/fileinfo/libmagic/file.h | 4 ++++
 ext/standard/microtime.c     | 2 +-
 sapi/phpdbg/phpdbg.c         | 2 +-
 4 files changed, 7 insertions(+), 2 deletions(-)

diff --git a/configure.ac b/configure.ac
index 5219a5f2..d01b53f9 100644
--- a/configure.ac
+++ b/configure.ac
@@ -394,6 +394,7 @@ dnl checks, if we already have the functions which are usually in libnsl. Also,
 dnl uClibc will bark at linking with glibc's libnsl.
 
 PHP_CHECK_FUNC(socket, socket)
+PHP_CHECK_FUNC(socket, network)
 PHP_CHECK_FUNC(socketpair, socket)
 PHP_CHECK_FUNC(htonl, socket)
 PHP_CHECK_FUNC(gethostname, nsl)
diff --git a/ext/fileinfo/libmagic/file.h b/ext/fileinfo/libmagic/file.h
index 698a307d..f69e60c7 100644
--- a/ext/fileinfo/libmagic/file.h
+++ b/ext/fileinfo/libmagic/file.h
@@ -445,7 +445,11 @@ struct magic_set {
 };
 
 /* Type for Unicode characters */
+#if defined(__HAIKU__)
+#include <SupportDefs.h>
+#else
 typedef unsigned long unichar;
+#endif
 
 #define FILE_T_LOCAL	1
 #define FILE_T_WINDOWS	2
diff --git a/ext/standard/microtime.c b/ext/standard/microtime.c
index 9bd45e18..fad5bd44 100644
--- a/ext/standard/microtime.c
+++ b/ext/standard/microtime.c
@@ -131,7 +131,7 @@ PHP_FUNCTION(getrusage)
 #ifdef PHP_WIN32 /* Windows only implements a limited amount of fields from the rusage struct */
 	PHP_RUSAGE_PARA(ru_majflt);
 	PHP_RUSAGE_PARA(ru_maxrss);
-#elif !defined(_OSD_POSIX)
+#elif !defined(_OSD_POSIX) && !defined(__HAIKU__)
 	PHP_RUSAGE_PARA(ru_oublock);
 	PHP_RUSAGE_PARA(ru_inblock);
 	PHP_RUSAGE_PARA(ru_msgsnd);
diff --git a/sapi/phpdbg/phpdbg.c b/sapi/phpdbg/phpdbg.c
index 8b01acdf..fe253f83 100644
--- a/sapi/phpdbg/phpdbg.c
+++ b/sapi/phpdbg/phpdbg.c
@@ -1735,7 +1735,7 @@ phpdbg_main:
 			}
 
 #ifndef _WIN32
-			zend_sigaction(SIGIO, &sigio_struct, NULL);
+			zend_sigaction(SIGPOLL, &sigio_struct, NULL);
 #endif
 
 			/* set remote flag to stop service shutting down upon quit */
-- 
2.27.0

