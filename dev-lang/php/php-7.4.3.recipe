SUMMARY="A popular general-purpose scripting language"
DESCRIPTION="PHP is a popular general-purpose scripting language that is \
especially suited to web development.
Fast, flexible and pragmatic, PHP powers everything from your blog to the most \
popular websites in the world."
HOMEPAGE="https://php.net/"
COPYRIGHT="2001-2020 PHP Group"
LICENSE="PHP License v3.01"
REVISION="1"
SOURCE_URI="https://php.net/get/php-$portVersion.tar.bz2/from/this/mirror"
CHECKSUM_SHA256="c1517ba49578fb2dcc64c73a3edc76d4fc507c4a7ac639981584cc7d3b4c6d14"
SOURCE_FILENAME="php-$portVersion.tar.bz2"
PATCHES="php-$portVersion.patchset"

ARCHITECTURES="!x86_gcc2 x86 x86_64"
SECONDARY_ARCHITECTURES="x86"

PROVIDES="
	php = $portVersion
	cmd:phar$secondaryArchSuffix
	cmd:phar.phar$secondaryArchSuffix
	cmd:php$secondaryArchSuffix
	cmd:php_cgi$secondaryArchSuffix
	cmd:php_config$secondaryArchSuffix
	cmd:phpdbg$secondaryArchSuffix
	cmd:phpize$secondaryArchSuffix
	"
REQUIRES="
	haiku$secondaryArchSuffix
	lib:libcrypto$secondaryArchSuffix
	lib:libcurl$secondaryArchSuffix
	lib:libiconv$secondaryArchSuffix
	lib:libicudata$secondaryArchSuffix
	lib:libicui18n$secondaryArchSuffix
	lib:libicuio$secondaryArchSuffix
	lib:libicuuc$secondaryArchSuffix
	lib:libjpeg$secondaryArchSuffix
	lib:libonig$secondaryArchSuffix
	lib:libpng16$secondaryArchSuffix
	lib:libsqlite3$secondaryArchSuffix
	lib:libssl$secondaryArchSuffix
	lib:libwebp$secondaryArchSuffix
	lib:libxml2$secondaryArchSuffix
	lib:libz$secondaryArchSuffix
	lib:libzip$secondaryArchSuffix
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	devel:libbz2$secondaryArchSuffix
	devel:libcrypto$secondaryArchSuffix
	devel:libcurl$secondaryArchSuffix
	devel:libfreetype$secondaryArchSuffix
	devel:libicuuc$secondaryArchSuffix
	devel:libjpeg$secondaryArchSuffix
	devel:libnghttp2$secondaryArchSuffix
	devel:libonig$secondaryArchSuffix
	devel:libpcre$secondaryArchSuffix
	devel:libpng16$secondaryArchSuffix
	devel:libssl$secondaryArchSuffix
	devel:libxml2$secondaryArchSuffix
	devel:libz$secondaryArchSuffix
	devel:libzip$secondaryArchSuffix
	devel:libsqlite3$secondaryArchSuffix
	devel:libwebp$secondaryArchSuffix
	devel:libiconv$secondaryArchSuffix
	"
BUILD_PREREQUIRES="
	cmd:aclocal
	cmd:automake
	cmd:autoreconf
	cmd:awk
	cmd:bison
	cmd:freetype_config
	cmd:gcc$secondaryArchSuffix
	cmd:icu_config$secondaryArchSuffix
	cmd:make
	cmd:pkg_config$secondaryArchSuffix
	cmd:xml2_config$secondaryArchSuffix
	"

BUILD()
{
	# libiconv detection workaround
	rm -rf iconv
	mkdir iconv
	mkdir iconv/include
	ln -s /boot/system/develop/lib${secondaryArchSubDir} iconv/lib
	ln -s /boot/system/develop/headers${secondaryArchSubDir}/libcharset.h iconv/include/libcharset.h
	ln -s /boot/system/develop/headers${secondaryArchSubDir}/localcharset.h iconv/include/localcharset.h
	ln -s /boot/system/develop/headers${secondaryArchSubDir}/iconv.h iconv/include/iconv.h

	autoreconf
	autoconf
	runConfigure ./configure \
		--with-openssl \
		--with-curl \
		--enable-intl \
		--enable-ftp \
		--enable-soap \
		--enable-mbstring \
		--with-zlib \
		--with-zip \
		--with-iconv="$PWD/iconv" \
		--enable-gd \
		--with-webp \
		--with-jpeg
	make $jobArgs
}

INSTALL()
{
	make install
	rm -rf $libDir/build # Only garbage is installed here.
}

TEST()
{
	make test
}
